import face_recognition
import argparse
import os
import  cv2
import numpy as np

# Tạo một trình phân tích cú pháp
parser = argparse.ArgumentParser()
parser.add_argument("-img1", help="Đường dẫn đến ảnh 1")
parser.add_argument("-img2", help="Đường dẫn đến ảnh 2")

# Phân tích các đối số từ dòng lệnh
args = parser.parse_args()

# Kiểm tra xem đã nhập đúng số lượng đối số hay chưa
if args.img1 is None or args.img2 is None:
    print("Bạn cần nhập đúng đường dẫn của cả hai ảnh.")
else:
    # Kiểm tra xem cả hai đường dẫn đều tồn tại
    if os.path.exists(args.img1) and os.path.exists(args.img2):
        # Tải và so sánh khuôn mặt từ hai ảnh
        image1 = face_recognition.load_image_file(args.img1)
        image2 = face_recognition.load_image_file(args.img2)

        # Tạo mã hóa (encodings) cho các khuôn mặt từ hai ảnh
        face_locations1 = face_recognition.face_locations(image1)
        face_locations2 = face_recognition.face_locations(image2)

        # Kiểm tra xem có khuôn mặt trong ảnh 1 hay không
        if not face_locations1:
            print("Không tìm thấy khuôn mặt trong ảnh 1.")
        else:
            # Kiểm tra xem có khuôn mặt trong ảnh 2 hay không
            if not face_locations2:
                print("Không tìm thấy khuôn mặt trong ảnh 2.")
            else:
                # So sánh khuôn mặt
                encoding1 = face_recognition.face_encodings(image1, [face_locations1[0]])[0]
                encoding2 = face_recognition.face_encodings(image2, [face_locations2[0]])[0]

                # Thực hiện so sánh khuôn mặt ở đây, ví dụ sử dụng face_recognition.face_distance
                face_distance = face_recognition.face_distance([encoding1], encoding2)

                if face_distance[0] < 0.6:  # Thay đổi ngưỡng tùy theo độ giống nhau mong muốn
                    print("Khuôn mặt giống nhau.")
                else:
                    print("Khuôn mặt không giống nhau.")
    else:
        print("Một hoặc cả hai đường dẫn đến ảnh không tồn tại.")
